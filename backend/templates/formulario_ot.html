<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Orden de Trabajo - CONMETAL</title>
    <style>
        /* Reset & page sizing to resemble the image */
        html,body{height:100%;margin:0;padding:0;font-family: 'Arial', sans-serif;background:#eee}
        .sheet{width:794px; /* ~A4 landscape 1123x794 scaled */
               margin:18px auto;border:3px solid #2b6f9a;background:#fff;padding:6px;box-sizing:border-box}

        table{border-collapse:collapse;width:100%;table-layout:fixed}
        td, th{border:1px solid #1f3b4b;padding:4px;font-size:12px;vertical-align:middle}

        /* Header */
        .hdr-top{background:linear-gradient(#cfeefc,#c2e6fb);height:56px}
        .logo {width:70px;height:52px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;color:#0b5370}
        .title {font-size:24px;font-weight:800;color:#083e55;text-align:center}
        .numero {background:#bfe6fb;text-align:center;font-weight:800;font-size:14px}
        .numero input{border:0;background:transparent;width:100%;text-align:center;font-weight:800}

        /* Row label style */
        .label{background:#f2f9fd;font-weight:700;color:#052e3a}
        .input{background:#fff}
        .yellow{background:#fff59d}
        .green{background:#b7e2a0}

        /* Section titles */
        .section{background:#cfe9f9;text-align:center;font-weight:800}

        /* Item column */
        .item{width:36px;text-align:center;background:#f6fbfd;font-weight:700}

        /* Narrow columns */
        .w12{width:12%}
        .w18{width:18%}
        .w25{width:25%}
        .w40{width:40%}

        /* Tasks table inputs */
        input[type=text], input[type=date], textarea, select{width:100%;border:0;padding:3px;background:transparent;font-size:12px}
        textarea{min-height:56px}

        /* Observations area */
        .obs{min-height:80px}

        /* Make borders darker like the image */
        .thick{border-top:3px solid #1f3b4b}

        /* Small tweaks to match image spacing */
        .no-border{border:none}

        /* Footer small labels */
        .small-label{font-weight:700;background:#f2f9fd}

        /* Botón guardar */
        .btn-guardar {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 200px;
        }
        .btn-guardar:hover {
            background: #45a049;
        }

        /* Mensajes de éxito/error */
        .mensaje {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="sheet">
        <form method="post">
            {% csrf_token %}
            <table>
                <!-- ENCABEZADO -->
                <tr>
                    <td colspan="4" class="hdr-top no-border">
                        <table style="width:100%;border-collapse:collapse;height:56px;">
                            <tr>
                                <td style="width:11%;border:none;padding:6px">
                                    <div class="logo">CONMETAL</div>
                                </td>
                                <td style="width:70%;border:none;padding:6px">
                                    <div class="title">ORDEN DE TRABAJO</div>
                                </td>
                                <td style="width:19%;border-left:3px solid #1f3b4b;padding:6px">
                                    <div style="display:flex;flex-direction:column;height:100%;justify-content:center">
                                        <div style="font-weight:700;color:#083e55">Nº:</div>
                                        <input type="text" name="numero_ot" value="{{ numero_ot_generado }}" readonly style="font-weight:800;font-size:14px;border:0;background:transparent;text-align:center;margin-top:4px">
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>

                <!-- DATOS PRINCIPALES -->
                <tr>
                    <td class="label" style="width:12%">FECHA:</td>
                    <td style="width:38%"><input type="date" name="fecha_creacion" value="{{ fecha_actual }}" required></td>
                    <td class="label" style="width:12%">EQUIPO/MAQUINA:</td>
                    <td class="yellow" style="width:38%">
                        <select name="equipo_id" required>
                            <option value="">Seleccionar equipo...</option>
                            {% for equipo in equipos %}
                            <option value="{{ equipo.id }}">{{ equipo.codigo }} - {{ equipo.nombre }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>

                <tr>
                    <td class="label">DESCRIPCION:</td>
                    <td colspan="2"><input type="text" name="descripcion_equipo"></td>
                    <td class="label">MARCA:</td>
                </tr>

                <tr>
                    <td class="label">UBICACIÓN:</td>
                    <td><input type="text" name="ubicacion"></td>
                    <td class="label">MODELO:</td>
                    <td class="yellow"><input type="text" name="modelo"></td>
                </tr>

                <tr>
                    <td class="label">TIPO DE ACCION:</td>
                    <td>
                        <select name="tipo_accion_id" required>
                            <option value="">Seleccionar tipo...</option>
                            {% for tipo in tipos_accion %}
                            <option value="{{ tipo.id }}">{{ tipo.nombre }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td class="label">ODOMETRO: (H) (Km)</td>
                    <td><input type="text" name="odometro"></td>
                </tr>

                <tr>
                    <td class="label">RESPONSABLE DE EJECUCION</td>
                    <td class="green">
                        <select name="responsable_ejecucion_id" required>
                            <option value="">Seleccionar responsable...</option>
                            {% for usuario in usuarios %}
                            <option value="{{ usuario.id }}">{{ usuario.nombre_completo }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td class="label">FECHA PLAN.</td>
                    <td><input type="date" name="fecha_planificada"></td>
                </tr>

                <tr>
                    <td class="label">SUPERVISOR</td>
                    <td colspan="3">
                        <select name="supervisor_id">
                            <option value="">Seleccionar supervisor...</option>
                            {% for usuario in usuarios %}
                            <option value="{{ usuario.id }}">{{ usuario.nombre_completo }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>

                <!-- TAREAS A EJECUTAR -->
                <tr><td colspan="4" class="section thick">TAREAS A EJECUTAR</td></tr>
                <tr>
                    <td class="item">ITEM</td>
                    <td class="w40">DETALLE</td>
                    <td class="w25">TIEMPO ESTIMADO</td>
                    <td class="w25">TIEMPO REAL</td>
                </tr>

                <!-- 5 filas tareas -->
                <tr>
                    <td class="item">1</td>
                    <td><input type="text" name="tarea_detalle_1" placeholder="Detalle de la tarea"></td>
                    <td><input type="number" name="tarea_tiempo_estimado_1" placeholder="Minutos" min="0"></td>
                    <td><input type="number" name="tarea_tiempo_real_1" placeholder="Minutos" min="0"></td>
                </tr>
                <tr>
                    <td class="item">2</td>
                    <td><input type="text" name="tarea_detalle_2" placeholder="Detalle de la tarea"></td>
                    <td><input type="number" name="tarea_tiempo_estimado_2" placeholder="Minutos" min="0"></td>
                    <td><input type="number" name="tarea_tiempo_real_2" placeholder="Minutos" min="0"></td>
                </tr>
                <tr>
                    <td class="item">3</td>
                    <td><input type="text" name="tarea_detalle_3" placeholder="Detalle de la tarea"></td>
                    <td><input type="number" name="tarea_tiempo_estimado_3" placeholder="Minutos" min="0"></td>
                    <td><input type="number" name="tarea_tiempo_real_3" placeholder="Minutos" min="0"></td>
                </tr>
                <tr>
                    <td class="item">4</td>
                    <td><input type="text" name="tarea_detalle_4" placeholder="Detalle de la tarea"></td>
                    <td><input type="number" name="tarea_tiempo_estimado_4" placeholder="Minutos" min="0"></td>
                    <td><input type="number" name="tarea_tiempo_real_4" placeholder="Minutos" min="0"></td>
                </tr>
                <tr>
                    <td class="item">5</td>
                    <td><input type="text" name="tarea_detalle_5" placeholder="Detalle de la tarea"></td>
                    <td><input type="number" name="tarea_tiempo_estimado_5" placeholder="Minutos" min="0"></td>
                    <td><input type="number" name="tarea_tiempo_real_5" placeholder="Minutos" min="0"></td>
                </tr>

                <!-- REPUESTOS REQUERIDOS -->
                <tr><td colspan="4" class="section thick">REPUESTOS REQUERIDOS</td></tr>
                <tr>
                    <td class="item">ITEM</td>
                    <td class="w25">CODIGO</td>
                    <td class="w40">DESCRIPCION</td>
                    <td class="w35">CANTIDAD</td>
                </tr>

                <!-- 5 filas repuestos -->
                <tr>
                    <td class="item">1</td>
                    <td class="green"><input type="text" name="repuesto_codigo_1" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="repuesto_descripcion_1" placeholder="Descripción"></td>
                    <td><input type="number" name="repuesto_cantidad_1" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">2</td>
                    <td class="green"><input type="text" name="repuesto_codigo_2" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="repuesto_descripcion_2" placeholder="Descripción"></td>
                    <td><input type="number" name="repuesto_cantidad_2" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">3</td>
                    <td class="green"><input type="text" name="repuesto_codigo_3" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="repuesto_descripcion_3" placeholder="Descripción"></td>
                    <td><input type="number" name="repuesto_cantidad_3" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">4</td>
                    <td class="green"><input type="text" name="repuesto_codigo_4" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="repuesto_descripcion_4" placeholder="Descripción"></td>
                    <td><input type="number" name="repuesto_cantidad_4" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">5</td>
                    <td class="green"><input type="text" name="repuesto_codigo_5" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="repuesto_descripcion_5" placeholder="Descripción"></td>
                    <td><input type="number" name="repuesto_cantidad_5" placeholder="Cantidad" min="1" value="1"></td>
                </tr>

                <!-- INSUMOS REQUERIDOS -->
                <tr><td colspan="4" class="section thick">INSUMOS REQUERIDOS</td></tr>
                <tr>
                    <td class="item">ITEM</td>
                    <td class="w25">CODIGO</td>
                    <td class="w40">DESCRIPCION</td>
                    <td class="w35">CANTIDAD</td>
                </tr>

                <!-- 5 filas insumos -->
                <tr>
                    <td class="item">1</td>
                    <td class="green"><input type="text" name="insumo_codigo_1" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="insumo_descripcion_1" placeholder="Descripción"></td>
                    <td><input type="number" name="insumo_cantidad_1" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">2</td>
                    <td class="green"><input type="text" name="insumo_codigo_2" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="insumo_descripcion_2" placeholder="Descripción"></td>
                    <td><input type="number" name="insumo_cantidad_2" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">3</td>
                    <td class="green"><input type="text" name="insumo_codigo_3" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="insumo_descripcion_3" placeholder="Descripción"></td>
                    <td><input type="number" name="insumo_cantidad_3" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">4</td>
                    <td class="green"><input type="text" name="insumo_codigo_4" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="insumo_descripcion_4" placeholder="Descripción"></td>
                    <td><input type="number" name="insumo_cantidad_4" placeholder="Cantidad" min="1" value="1"></td>
                </tr>
                <tr>
                    <td class="item">5</td>
                    <td class="green"><input type="text" name="insumo_codigo_5" placeholder="Código"></td>
                    <td class="yellow"><input type="text" name="insumo_descripcion_5" placeholder="Descripción"></td>
                    <td><input type="number" name="insumo_cantidad_5" placeholder="Cantidad" min="1" value="1"></td>
                </tr>

                <!-- FINALIZACION -->
                <tr><td colspan="4" class="section thick">FINALIZACION DE TRABAJO</td></tr>
                <tr>
                    <td class="small-label">REVISADO POR</td>
                    <td><input type="text" name="revisado_por"></td>
                    <td class="small-label">FECHA</td>
                    <td><input type="date" name="fecha_revision"></td>
                </tr>
                <tr>
                    <td class="small-label">FIRMA</td>
                    <td></td>
                    <td class="small-label">RECIBIDO POR</td>
                    <td><input type="text" name="recibido_por"></td>
                </tr>
                <tr>
                    <td class="small-label" colspan="4">OBSERVACIONES</td>
                </tr>
                <tr>
                    <td colspan="4" class="obs"><textarea name="observaciones" placeholder="Observaciones generales..."></textarea></td>
                </tr>

                <!-- BOTÓN GUARDAR -->
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px;">
                        <button type="submit" class="btn-guardar">GUARDAR ORDEN DE TRABAJO</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <script>
        // Auto-generar número de OT más robusto
        function generarNumeroOT() {
            const ahora = new Date();
            const año = ahora.getFullYear().toString().slice(-2);
            const mes = (ahora.getMonth() + 1).toString().padStart(2, '0');
            const dia = ahora.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `${random}-${año}`;
        }

        // Llenar automáticamente algunos campos al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            // Poner fecha actual si no hay valor
            const hoy = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="fecha_creacion"]').value = hoy;
            
            // Auto-generar número de OT si está vacío
            const numeroOTInput = document.querySelector('input[name="numero_ot"]');
            if (!numeroOTInput.value) {
                numeroOTInput.value = generarNumeroOT();
            }
        });

        // Validación básica antes de enviar
        document.querySelector('form').addEventListener('submit', function(e) {
            const equipo = document.querySelector('select[name="equipo_id"]').value;
            const tipoAccion = document.querySelector('select[name="tipo_accion_id"]').value;
            const responsable = document.querySelector('select[name="responsable_ejecucion_id"]').value;
            
            if (!equipo || !tipoAccion || !responsable) {
                e.preventDefault();
                alert('Por favor complete los campos obligatorios: Equipo, Tipo de Acción y Responsable de Ejecución');
                return false;
            }
        });
    </script>
</body>
</html>