<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Reportes - CONMETAL</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    /* MISMO ESTILO BASE (UNIFICADO) */
    :root { --primary: #1f3b4b; --secondary: #334155; --accent: #3b82f6; --bg-main: #f1f5f9; --bg-card: #ffffff; --border: #e2e8f0; --text-main: #334155; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: var(--bg-main); margin: 0; height: 100vh; display: flex; overflow: hidden; }
    
    .sidebar { width: 280px; background: var(--primary); color: white; display: flex; flex-direction: column; position: fixed; top: 0; bottom: 0; left: 0; z-index: 1000; box-shadow: 4px 0 15px rgba(0,0,0,0.1); }
    .main-content { margin-left: 280px; padding: 40px; flex: 1; overflow-y: auto; }
    
    .sidebar-header { padding: 28px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 20px; }
    .logo-icon { width: 40px; height: 40px; background: var(--accent); border-radius: 8px; display: grid; place-items: center; }
    .nav-links { padding: 24px 16px; flex: 1; }
    .nav-item { display: flex; gap: 12px; padding: 12px 16px; color: #94a3b8; text-decoration: none; border-radius: 8px; margin-bottom: 4px; transition: 0.2s; font-size: 14px; font-weight: 500; align-items: center; }
    .nav-item:hover { background: rgba(255,255,255,0.05); color: white; }
    .nav-item.active { background: var(--accent); color: white; font-weight: 600; }

    /* GRID GRÁFICOS */
    .grid-charts { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; max-width: 1400px; margin: 0 auto; }
    .full { grid-column: 1 / -1; }
    
    .card { background: white; padding: 25px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
    .chart-title { text-align: center; font-weight: 700; color: var(--primary); text-transform: uppercase; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; font-size: 16px; }
    .chart-box { position: relative; height: 300px; }
    .no-data { height: 100%; display: flex; align-items: center; justify-content: center; color: #999; font-style: italic; }
</style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header"><div class="logo-icon">C</div> <span>CONMETAL</span></div>
    <nav class="nav-links">
        <a href="index.html" class="nav-item"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg> Ingreso OT</a>
        <a href="ot_listado.html" class="nav-item"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg> Visualizaciones OT</a>
        <a href="ot_graficos.html" class="nav-item active"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> Reportes Gráficos</a>
    </nav>
</div>

<div class="main-content">
    <div class="grid-charts">
        <div class="card"><div class="chart-title">Efectividad (Lograda vs No)</div><div class="chart-box"><canvas id="c1"></canvas></div></div>
        <div class="card"><div class="chart-title">Tipos de Falla</div><div class="chart-box"><canvas id="c2"></canvas></div></div>
        <div class="card"><div class="chart-title">Ubicación</div><div class="chart-box"><canvas id="c3"></canvas></div></div>
        <div class="card"><div class="chart-title">Top Encargados</div><div class="chart-box"><canvas id="c4"></canvas></div></div>
        <div class="card full"><div class="chart-title">Máquinas Críticas</div><div class="chart-box"><canvas id="c5"></canvas></div></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch('http://127.0.0.1:8000/api/ot-resumen/');
            const d = await res.json();
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#64748b';

            const render = (id, type, labels, data, bg, idx='x') => {
                const ctx = document.getElementById(id).getContext('2d');
                if(!data.length) { ctx.canvas.parentNode.innerHTML = '<div class="no-data">Sin datos</div>'; return; }
                new Chart(ctx, {
                    type: type,
                    data: { labels: labels, datasets: [{ data: data, backgroundColor: bg }] },
                    options: { maintainAspectRatio: false, indexAxis: idx, plugins: { legend: { display: type!=='bar', position: 'right' } } }
                });
            };

            render('c1', 'doughnut', d.resumen_estado.map(x=>x.mantencion_lograda==='SÍ'?'Lograda':'Pendiente'), d.resumen_estado.map(x=>x.total), ['#10b981','#ef4444']);
            render('c2', 'pie', d.resumen_tipo.map(x=>x.tipo_accion), d.resumen_tipo.map(x=>x.total), ['#3b82f6','#f59e0b','#8b5cf6']);
            render('c3', 'bar', d.resumen_ubicacion.map(x=>x.ubicacion), d.resumen_ubicacion.map(x=>x.total), '#2b6f9a', 'y');
            render('c4', 'bar', d.resumen_encargado.map(x=>x.encargado), d.resumen_encargado.map(x=>x.total_ot), '#1f3b4b');
            render('c5', 'bar', d.resumen_maquina.map(x=>x.maquina), d.resumen_maquina.map(x=>x.total), '#f59e0b', 'y');
        } catch(e) {}
    });
</script>
</body>
</html>